# 国際化（i18n）サポート

[English](../en/I18N.md) | 日本語

## 概要
Gemini Mail Review アドオンは国際化をサポートしており、Thunderbird の言語設定に合わせて自動的に UI を表示します。

## サポートされている言語
- **英語（en）** - デフォルト言語
- **日本語（ja）** - 日本語対応

## 機能
- Thunderbird のロケールに基づく自動言語検出
- 現在のロケールがサポートされていない場合は英語にフォールバック
- 以下を含むすべての UI 要素が翻訳されます：
  - 拡張機能名と説明
  - オプションページ（設定）
  - ポップアップインターフェース（メールレビュー）
  - ボタン、ラベル、メッセージ
  - エラーメッセージとステータステキスト

## 実装詳細

### ディレクトリ構造
```
_locales/
├── en/
│   └── messages.json    # 英語翻訳
└── ja/
    └── messages.json    # 日本語翻訳
```

### 動作の仕組み
1. アドオンは WebExtension `browser.i18n` API を使用します
2. Thunderbird は現在のロケール設定を自動的に検出します
3. アドオンは対応する `messages.json` ファイルをロードします
4. すべての UI テキストは実行時にローカライズされた文字列に置き換えられます
5. ロケールがサポートされていない場合、デフォルトで英語が使用されます

### 翻訳例

#### 拡張機能名
- 英語："Gemini Mail Review"
- 日本語："Gemini メールレビュー"

#### オプションページのタイトル
- 英語："Gemini Mail Review Settings"
- 日本語："Gemini メールレビュー 設定"

#### 保存ボタン
- 英語："Save Settings"
- 日本語："設定を保存"

#### エラーメッセージ
- 英語："Please configure your Gemini API key in the settings."
- 日本語："設定で Gemini API キーを設定してください。"

#### カスタムプロンプトテンプレート
- 英語："Custom Prompt Templates:"
- 日本語："カスタムプロンプトテンプレート:"

#### テンプレート選択
- 英語："Select Custom Prompt Template:"
- 日本語："カスタムプロンプトテンプレートを選択:"

#### テンプレート名
- 英語："Template 1 Name:", "Template 2 Name:", "Template 3 Name:"
- 日本語："テンプレート1の名前:", "テンプレート2の名前:", "テンプレート3の名前:"

## テスト方法

### Thunderbird の言語を変更する
1. Thunderbird を開く
2. **設定** > **一般** > **言語**に移動
3. 希望の言語を選択（英語または日本語）
4. Thunderbird を再起動
5. アドオンのオプションまたはポップアップを開く - 選択した言語で表示されます

### 言語サポートの確認
1. Thunderbird にアドオンをインストール
2. 英語ロケールでテスト：
   - Thunderbird の言語を英語に設定
   - Thunderbird を再起動
   - アドオン設定を開く - 英語で表示されるはずです
3. 日本語ロケールでテスト：
   - Thunderbird の言語を日本語に設定
   - Thunderbird を再起動
   - アドオン設定を開く - 日本語で表示されるはずです

## 新しい言語の追加

追加言語のサポートを追加するには：

1. 新しいロケールディレクトリを作成：
   ```bash
   mkdir -p _locales/{locale_code}/
   ```

2. 英語のメッセージファイルをテンプレートとしてコピー：
   ```bash
   cp _locales/en/messages.json _locales/{locale_code}/messages.json
   ```

3. 新しい `messages.json` ファイル内のすべてのメッセージ値を翻訳：
   ```json
   {
     "extensionName": {
       "message": "ここに翻訳を入力",
       "description": "拡張機能の名前"
     },
     ...
   }
   ```

4. Thunderbird を新しいロケールに設定してテスト

### 例：フランス語サポートの追加
```bash
mkdir -p _locales/fr/
cp _locales/en/messages.json _locales/fr/messages.json
# _locales/fr/messages.json を編集し、すべての "message" 値をフランス語に翻訳
```

## 技術詳細

### 使用される API
- `browser.i18n.getMessage(messageName)` - ローカライズされた文字列を取得
- `browser.i18n.getUILanguage()` - 現在のロケールを取得（オプション）

### 変更されたファイル
- `manifest.json` - `default_locale` と i18n プレースホルダーを追加
- `options.html` - テキスト要素に `data-i18n` 属性を追加
- `options.js` - ローカライズされた文字列をロードする `localizeUI()` 関数を追加
- `popup.html` - テキスト要素に `data-i18n` 属性を追加
- `popup.js` - ローカライズされた文字列をロードする `localizeUI()` 関数を追加

### ローカライゼーションプロセス
1. ページがロード、HTML にはフォールバックとして英語テキストが含まれています
2. `DOMContentLoaded` で `localizeUI()` 関数が呼び出されます
3. 関数は `data-i18n` 属性を持つすべての要素をクエリします
4. 各要素について、`browser.i18n.getMessage()` を使用してローカライズされたメッセージを取得します
5. 要素の `textContent` または `placeholder` をローカライズされた文字列で更新します

## ブラウザ互換性
- Thunderbird 102.0 以降（完全サポート）
- すべての最新の WebExtension 互換ブラウザ（移植された場合）

## 注意事項
- i18n 実装は Mozilla の WebExtension 標準に従っています
- すべての文字列は保守しやすいように JSON 形式で保存されます
- システムは拡張可能です - コード変更なしで新しい言語を追加できます
- フォールバックにより、サポートされていないロケールでもアドオンは常に動作します
